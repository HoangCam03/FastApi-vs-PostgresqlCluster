# Primary node configuration
listen_addresses = '*'          # Lắng nghe trên mọi IP trong container
port = 5432                     # Cổng dịch vụ PostgreSQL
max_connections = 100           # Tối đa số kết nối đồng thời
shared_buffers = 256MB          # RAM dành cho cache page của PostgreSQL
effective_cache_size = 1GB      # Ước lượng tổng cache (OS + PG) để query planner quyết định plan
maintenance_work_mem = 64MB     # RAM cho VACUUM/CREATE INDEX/ALTER TABLE...
checkpoint_completion_target = 0.9  # Trải checkpoint đều 90% chu kỳ để giảm burst I/O
wal_buffers = 16MB              # Buffer ghi WAL trước khi flush ra đĩa
default_statistics_target = 100 # Độ chi tiết thống kê cho optimizer (cao hơn = plan chính xác hơn)
random_page_cost = 1.1          # Chi phí đọc ngẫu nhiên (SSD để thấp để ưu tiên index scan)
effective_io_concurrency = 200  # Số request I/O song song mà storage chịu được (SSD/NVMe cao)
work_mem = 4MB                  # RAM cho mỗi phép sort/hash trong 1 operation của 1 truy vấn
min_wal_size = 1GB              # Kích thước WAL tối thiểu giữ lại
max_wal_size = 4GB              # Kích thước WAL tối đa trước khi ép checkpoint

# Replication settings - Tăng lên để hỗ trợ nhiều replica
wal_level = replica             # Ghi WAL đủ thông tin cho standby/replica apply
max_wal_senders = 10            # Tăng lên để hỗ trợ nhiều replica hơn
max_replication_slots = 10      # Tăng tương ứng
hot_standby = on                # Cho phép chạy truy vấn khi ở chế độ standby (hữu ích khi failover)

# HBA location (use mounted pg_hba.conf)
hba_file = '/etc/postgresql/pg_hba.conf'